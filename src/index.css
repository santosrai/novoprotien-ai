@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===== App Theme Variables ===== */
:root {
  /* Light theme (default) */
  --app-bg: 248 250 252;           /* slate-50 */
  --app-bg-secondary: 255 255 255;  /* white */
  --app-bg-tertiary: 241 245 249;   /* slate-100 */
  --app-bg-hover: 226 232 240;      /* slate-200 */
  --app-text: 15 23 42;             /* slate-900 */
  --app-text-secondary: 71 85 105;  /* slate-600 */
  --app-text-muted: 148 163 184;    /* slate-400 */
  --app-border: 226 232 240;        /* slate-200 */
  --app-border-strong: 203 213 225; /* slate-300 */
  --app-primary: 59 130 246;        /* blue-500 */
  --app-primary-hover: 37 99 235;   /* blue-600 */
  --app-card: 255 255 255;          /* white */
  --app-card-hover: 248 250 252;    /* slate-50 */
  --app-input: 255 255 255;         /* white */
  --app-input-border: 203 213 225;  /* slate-300 */
  --app-shadow: 0 0 0 / 0.1;
  color-scheme: light;
}

.dark {
  /* Dark theme */
  --app-bg: 15 23 42;               /* slate-900 */
  --app-bg-secondary: 30 41 59;     /* slate-800 */
  --app-bg-tertiary: 51 65 85;      /* slate-700 */
  --app-bg-hover: 71 85 105;        /* slate-600 */
  --app-text: 248 250 252;          /* slate-50 */
  --app-text-secondary: 203 213 225;/* slate-300 */
  --app-text-muted: 148 163 184;    /* slate-400 */
  --app-border: 51 65 85;           /* slate-700 */
  --app-border-strong: 71 85 105;   /* slate-600 */
  --app-primary: 96 165 250;        /* blue-400 */
  --app-primary-hover: 147 197 253; /* blue-300 */
  --app-card: 30 41 59;             /* slate-800 */
  --app-card-hover: 51 65 85;       /* slate-700 */
  --app-input: 51 65 85;            /* slate-700 */
  --app-input-border: 71 85 105;    /* slate-600 */
  --app-shadow: 0 0 0 / 0.3;
  color-scheme: dark;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: rgb(var(--app-bg));
  color: rgb(var(--app-text));
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* ===== Dark Mode Utility Classes ===== */
@layer utilities {
  /* Background utilities */
  .bg-app { background-color: rgb(var(--app-bg)); }
  .bg-app-secondary { background-color: rgb(var(--app-bg-secondary)); }
  .bg-app-tertiary { background-color: rgb(var(--app-bg-tertiary)); }
  .bg-app-card { background-color: rgb(var(--app-card)); }
  .bg-app-input { background-color: rgb(var(--app-input)); }
  
  /* Text utilities */
  .text-app { color: rgb(var(--app-text)); }
  .text-app-secondary { color: rgb(var(--app-text-secondary)); }
  .text-app-muted { color: rgb(var(--app-text-muted)); }
  
  /* Border utilities */
  .border-app { border-color: rgb(var(--app-border)); }
  .border-app-strong { border-color: rgb(var(--app-border-strong)); }
  .border-app-input { border-color: rgb(var(--app-input-border)); }
  
  /* Hover states */
  .hover\:bg-app-hover:hover { background-color: rgb(var(--app-bg-hover)); }
  .hover\:bg-app-card-hover:hover { background-color: rgb(var(--app-card-hover)); }
}

/* ===== Dark Mode Component Overrides ===== */

/* General card/panel styling */
.dark .bg-white {
  background-color: rgb(var(--app-card));
}

.dark .bg-gray-50 {
  background-color: rgb(var(--app-bg));
}

.dark .bg-gray-100 {
  background-color: rgb(var(--app-bg-tertiary));
}

/* Text colors in dark mode */
.dark .text-gray-900 {
  color: rgb(var(--app-text));
}

.dark .text-gray-800 {
  color: rgb(var(--app-text));
}

.dark .text-gray-700 {
  color: rgb(var(--app-text-secondary));
}

.dark .text-gray-600 {
  color: rgb(var(--app-text-secondary));
}

.dark .text-gray-500 {
  color: rgb(var(--app-text-muted));
}

.dark .text-gray-400 {
  color: rgb(var(--app-text-muted));
}

/* Border colors in dark mode */
.dark .border-gray-200 {
  border-color: rgb(var(--app-border));
}

.dark .border-gray-300 {
  border-color: rgb(var(--app-border-strong));
}

/* Form inputs in dark mode */
.dark input:not([type="checkbox"]):not([type="radio"]),
.dark textarea,
.dark select {
  background-color: rgb(var(--app-input));
  border-color: rgb(var(--app-input-border));
  color: rgb(var(--app-text));
}

.dark input:not([type="checkbox"]):not([type="radio"])::placeholder,
.dark textarea::placeholder {
  color: rgb(var(--app-text-muted));
}

.dark input:not([type="checkbox"]):not([type="radio"]):focus,
.dark textarea:focus,
.dark select:focus {
  border-color: rgb(var(--app-primary));
  outline-color: rgb(var(--app-primary));
}

/* Hover states in dark mode */
.dark .hover\:bg-gray-50:hover {
  background-color: rgb(var(--app-bg-tertiary));
}

.dark .hover\:bg-gray-100:hover {
  background-color: rgb(var(--app-bg-hover));
}

/* Dialog/Modal backgrounds */
.dark .bg-black\/50,
.dark .bg-black.bg-opacity-50 {
  background-color: rgba(0, 0, 0, 0.7);
}

/* Scrollbar styling for dark mode */
.dark ::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.dark ::-webkit-scrollbar-track {
  background: rgb(var(--app-bg-secondary));
}

.dark ::-webkit-scrollbar-thumb {
  background: rgb(var(--app-border-strong));
  border-radius: 4px;
}

.dark ::-webkit-scrollbar-thumb:hover {
  background: rgb(var(--app-text-muted));
}

/* Focus ring adjustments for dark mode */
.dark .focus\:ring-blue-500:focus {
  --tw-ring-color: rgb(var(--app-primary));
}

/* Button hover states in dark mode */
.dark .bg-blue-600:hover {
  background-color: rgb(59 130 246);
}

/* Shadow adjustments for dark mode */
.dark .shadow,
.dark .shadow-sm,
.dark .shadow-md,
.dark .shadow-lg,
.dark .shadow-xl {
  --tw-shadow-color: rgba(0, 0, 0, 0.4);
}

/* React Flow Handle Styles - n8n-like */
.custom-handle {
  width: 12px !important;
  height: 12px !important;
  background: #9ca3af !important;
  border: 2px solid white !important;
  border-radius: 50% !important;
  position: absolute !important;
  transition: all 0.2s !important;
}

.custom-handle:hover {
  background: #6b7280 !important;
  transform: scale(1.1) !important;
}

.custom-handle::after {
  content: '+' !important;
  position: absolute !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%) !important;
  color: white !important;
  font-size: 10px !important;
  font-weight: bold !important;
  line-height: 1 !important;
  pointer-events: none !important;
}

/* Connection line styles */
.react-flow__edge-path {
  stroke: #9ca3af;
  stroke-width: 2;
}

.react-flow__edge.selected .react-flow__edge-path {
  stroke: #3b82f6;
  stroke-width: 3;
}

/* ===== Pipeline Canvas Execution Animations ===== */

/* Pulsing glow animation for running nodes */
@keyframes pulse-glow {
  0%, 100% {
    box-shadow: 0 0 10px rgba(59, 130, 246, 0.4), 0 0 20px rgba(59, 130, 246, 0.2);
  }
  50% {
    box-shadow: 0 0 20px rgba(59, 130, 246, 0.6), 0 0 40px rgba(59, 130, 246, 0.3);
  }
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

/* Animated edge for data flow */
.react-flow__edge.animated path {
  stroke-dasharray: 5;
  animation: dash-flow 0.5s linear infinite;
}

@keyframes dash-flow {
  from {
    stroke-dashoffset: 10;
  }
  to {
    stroke-dashoffset: 0;
  }
}

/* Node success checkmark animation */
@keyframes success-pop {
  0% {
    transform: scale(0);
    opacity: 0;
  }
  50% {
    transform: scale(1.2);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.animate-success-pop {
  animation: success-pop 0.3s ease-out forwards;
}

/* Running node border animation */
@keyframes border-pulse {
  0%, 100% {
    border-color: rgba(59, 130, 246, 0.5);
  }
  50% {
    border-color: rgba(59, 130, 246, 1);
  }
}

.animate-border-pulse {
  animation: border-pulse 1.5s ease-in-out infinite;
}

/* Data particle animation along edges */
@keyframes particle-flow {
  0% {
    offset-distance: 0%;
    opacity: 1;
  }
  100% {
    offset-distance: 100%;
    opacity: 0;
  }
}

.edge-particle {
  animation: particle-flow 1.5s linear infinite;
}

/* Execution progress bar shimmer */
@keyframes shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

.animate-shimmer {
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0) 0%,
    rgba(255, 255, 255, 0.2) 50%,
    rgba(255, 255, 255, 0) 100%
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

/* Node status ring animation */
@keyframes status-ring {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  100% {
    transform: scale(1.5);
    opacity: 0;
  }
}

.animate-status-ring {
  animation: status-ring 1s ease-out infinite;
}

/* Execution log entry slide-in */
@keyframes slide-in {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.animate-slide-in {
  animation: slide-in 0.3s ease-out forwards;
}

/* Success glow effect */
@keyframes success-glow {
  0% {
    box-shadow: 0 0 5px rgba(34, 197, 94, 0.3);
  }
  50% {
    box-shadow: 0 0 15px rgba(34, 197, 94, 0.5);
  }
  100% {
    box-shadow: 0 0 5px rgba(34, 197, 94, 0.3);
  }
}

/* Error shake animation */
@keyframes error-shake {
  0%, 100% {
    transform: translateX(0);
  }
  10%, 30%, 50%, 70%, 90% {
    transform: translateX(-2px);
  }
  20%, 40%, 60%, 80% {
    transform: translateX(2px);
  }
}

.animate-error-shake {
  animation: error-shake 0.5s ease-in-out;
}

/* Dark theme adjustments for React Flow */
.react-flow.bg-\[#1a1a2e\] .react-flow__node {
  color: #e5e7eb;
}

.react-flow.bg-\[#1a1a2e\] .react-flow__controls {
  background: #1e1e32;
  border-color: #374151;
}

.react-flow.bg-\[#1a1a2e\] .react-flow__controls button {
  background: #1e1e32;
  border-color: #374151;
  color: #9ca3af;
}

.react-flow.bg-\[#1a1a2e\] .react-flow__controls button:hover {
  background: #374151;
}

.react-flow.bg-\[#1a1a2e\] .react-flow__minimap {
  background: #1e1e32;
}

/* Edge animation enhancements */
.react-flow__edge.animated path {
  stroke-dasharray: 5, 5;
  animation: edge-flow 0.5s linear infinite;
}

@keyframes edge-flow {
  from {
    stroke-dashoffset: 10;
  }
  to {
    stroke-dashoffset: 0;
  }
}

/* Smooth transitions for node status changes */
.react-flow__node {
  transition: box-shadow 0.3s ease, border-color 0.3s ease, opacity 0.3s ease;
}

/* Mobile-specific utilities */
@media (max-width: 640px) {
  /* Prevent text selection on mobile for better UX */
  button, a {
    -webkit-tap-highlight-color: transparent;
  }
  
  /* Improve touch targets */
  button, a, input, textarea, select {
    min-height: 44px;
    min-width: 44px;
  }
  
  /* Better scrolling on mobile */
  * {
    -webkit-overflow-scrolling: touch;
  }
}

/* Responsive text sizing */
@media (max-width: 640px) {
  .text-responsive {
    font-size: 0.875rem;
  }
}

/* Mobile-friendly table scrolling */
@media (max-width: 768px) {
  table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
}

/* Custom scrollbar styles for FileBrowser */
.file-browser-scrollbar {
  scrollbar-width: thin;
  scrollbar-color: #cbd5e1 #f1f5f9;
}

.file-browser-scrollbar::-webkit-scrollbar {
  width: 8px;
}

.file-browser-scrollbar::-webkit-scrollbar-track {
  background: #f1f5f9;
  border-radius: 4px;
}

.file-browser-scrollbar::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 4px;
}

.file-browser-scrollbar::-webkit-scrollbar-thumb:hover {
  background: #94a3b8;
}